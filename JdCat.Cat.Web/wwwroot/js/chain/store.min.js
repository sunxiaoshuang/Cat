(function(){var t,i,n,r;t=new Vue({el:"#app",data:{paging:{pageSize:20,pageIndex:1},stores:[]},methods:{loadData:function(){var n=this;axios.get(`/chain/getstores?pageIndex=${n.paging.pageIndex}&pageSize=${n.paging.pageSize}`).then(function(t){var i=(n.paging.pageIndex-1)*n.paging.pageSize;n.stores=t.data;n.stores.forEach((n,t)=>{n.index=i+t+1})}).catch(function(n){$.alert(n)})},create:function(){$.view({title:"新增门店",footDisplay:!0,url:"/chain/create",load:function(){i=new Vue({el:"#createVue",data:{entity:{city:null},password:null,showError:!1,province:[],city:null,area:null},created:function(){for(var n in r)this.province.push(n)},watch:{"entity.province":function(n){var i=r[n],t;this.city=[];for(t in i)this.city.push(t);this.area=[];this.entity.city=null;this.entity.area=null},"entity.city":function(n){if(n){var t=r[this.entity.province],i=t[n];this.area=JSON.parse(JSON.stringify(i));this.entity.area=null}}}});this.on("hidden.bs.modal",function(){i&&(i.$destroy(),i=null)})},submit:function(){i.showError=!0;var n=i.entity;return!n.name||!n.code||!n.password||!n.contact||!n.mobile||!n.province||!n.city||!n.area||!n.address||!i.password?($.alert("请将表单输入完整！"),!1):n.password!==i.password?($.alert("两次输入的密码不一致！"),!1):(axios.post("/chain/create",n).then(function(n){if(!n.data.success){$.alert(n.data.msg);return}$.alert(n.data.msg,"success");var i=1;t.stores.length>0&&(i=t.stores[t.stores.length-1].index+1);n.data.data.index=i;t.stores.push(n.data.data)}).catch(function(n){$.alert(n)}),!0)}})},bind:function(){$.view({title:"绑定门店",footDisplay:!0,url:"/chain/bind",load:function(){n=new Vue({el:"#bindVue",data:{storeId:null,code:null,password:null,showError:!1}});this.on("hidden.bs.modal",function(){n&&(n.$destroy(),n=null)})},submit:function(){return(n.showError=!0,!n.storeId||!n.code||!n.password)?($.alert("请将信息填写完整"),!1):(axios.post(`/chain/bind?storeId=${n.storeId}&code=${n.code}&password=${n.password}`).then(function(n){if(!n.data.success){$.alert(n.data.msg);return}$.alert(n.data.msg,"success");var i=1;t.stores.length>0&&(i=t.stores[t.stores.length-1].index+1);n.data.data.index=i;t.stores.push(n.data.data)}).catch(function(n){$.alert(n)}),!0)}})},unbind:function(n){var t=this;$.primary(`确定解绑门店【${n.name}】吗？`,function(){return axios.get(`/chain/unbind/${n.id}`).then(function(i){if(!i.data.success){$.alert(i.data.msg);return}$.alert(i.data.msg,"success");t.stores.remove(n)}).catch(function(n){$.alert(n)}),!0})},resetPassword:function(n){$.primary("确定重置密码吗?",function(){return $.loading(),axios.get("/Chain/ResetPwd/"+n.id).then(function(n){setTimeout(function(){$.loaded();$.primary("重置后的密码为："+n.data)},1e3)}).catch(function(n){$.alert(n)}),!0})}},created:function(){this.loadData();axios.get("/data/city.json").then(function(n){r=n.data}).catch(function(n){$.alert(n)})}})})();