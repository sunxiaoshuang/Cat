(function(n){var i={listItemType:'<div class="list-type-item form-horizontal clearfix new" data-id="{id}">                <label class="pull-left control-label">                    <span>分类名称：<\/span>                <\/label>                <div class="pull-left width-35 margin-right-20 require relative">                    <input type="text" class="form-control" name="name" value="{name}" placeholder="请输入分类名称" />                <\/div>                <div class="pull-left width-20 margin-right-20 require relative">                    <input type="number" value="{sort}" name="sort" class="form-control" placeholder="排序码" />                <\/div>                <label class="pull-left control-label">                    <i class="fa pull-left opr-slide opr-icon absolute fa-remove type-remove" title="删除"><\/i>                <\/label>            <\/div>'},u;n("#btnType").click(function(){n.view({name:"type",title:"添加类别",url:"/product/addtype",footDisplay:"block"})});n(document).on("click","#btnAddType",function(){var f=n("#txtTypeName").val(),r=n(".list-type"),t=0,e=r.find(":not(div.remove) input[type='number']"),u;return e.each(function(){var i=n(this).val();i=i||0;i=parseInt(i);t<i&&(t=i)}),u=i.listItemType.format({id:0,name:f,sort:t+1}),r.append(u),n("#txtTypeName").val(""),!1}).on("click","#type .btn-save",function(){var r=n(".list-type"),u=r.find(".list-type-item.new"),f=r.find(".list-type-item.edit"),e=r.find(".list-type-item.remove"),i={add:[],edit:[],remove:[]};return u.each(function(){var t=n(this),r=t.find("input[name='name']").val(),u=t.find("input[name='sort']").val();i.add.push({name:r,sort:u,id:0})}),f.each(function(){var t=n(this),r=t.find("input[name='name']").val(),u=t.find("input[name='sort']").val(),f=t.data("id");i.edit.push({name:r,sort:u,id:f})}),e.each(function(){var t=n(this).data("id");i.remove.push(t)}),n.loading(),n.post("/product/updatetypes",i,function(i){var r,u;if(n.loaded(),!i.success){n.error(i.msg);return}r=i.data;n("#type").modal("hide");r.forEach(function(n){n.selected=!1});u=t.list.first(function(n){return n.selected});u&&(r.first(function(n){return n.id===u.id}).selected=!0);t.list=r}),!1}).on("change","#type input",function(){var i=n(this),t=i.closest(".list-type-item");t.length!==0&&(t.hasClass("new")||t.addClass("edit"))}).on("click","#type .fa-remove",function(){var t=n(this).closest(".list-type-item");if(t.hasClass("new")){t.remove();return}n.post("/product/existproduct/"+t.data("id"),null,function(i){if(i.data){n.danger("类别下存在商品，不允许删除");return}t.removeClass("edit").addClass("remove");t.hide()})});var r={count:function(n){if(n.length===0)return 0;var t=0;return n.forEach(function(n){t+=n.count}),t}},f=pageData.types.map(function(n){return n.selected=!1,n}),t=new Vue({el:"#category",data:{list:pageData.types,productCount:r.count(pageData.types),allSelected:!0},methods:{typeClick:function(n){this.list.forEach(function(n){n.selected=!1});n.selected=!0;this.allSelected=!1},allClick:function(){this.list.forEach(function(n){n.selected=!1});this.allSelected=!0}}});Vue.filter("stock",function(n){return n<0?"无限":n});Vue.filter("attribute",function(n){if(!n||n.length===0)return"";let t="";return n.forEach(function(n){t+=n.name+"/"}),t.substr(0,t.length-1)});u=new Vue({el:"#productList",data:{list:[]},methods:{getImage:function(n){return n.images.length===0?"":"http://localhost:5002/File/Product/"+n.businessId+"/200x150/"+n.images[0].name+"."+n.images[0].extensionName},delProduct:function(t){var i=this;n.confirm("提示","确定删除商品【"+t.name+"】？",function(){return axios.post("/Product/DelProduct/"+t.id).then(function(r){if(!r.data.success){n.alert(r.data.msg);return}n.alert("删除成功","success");i.list.remove(t)}).catch(function(t){n.alert(t)}),!0})},toggleStatus:function(t){var i=t.status===1?"Down":"Up";axios.post("/Product/"+i+"/"+t.id).then(function(i){t.status=t.status===1?2:1;n.alert(i.data,"success")}).catch(function(){n.alert(data)})}}});n.loading();axios.post("/Product/GetProducts").then(function(){n.loaded()}).catch(function(t){n.loaded();n.alert(t)})})(jQuery);