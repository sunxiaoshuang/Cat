(function(n){function i(){n.loading();axios.get("/Product/GetProducts?pageIndex="+t.pageIndex).then(function(i){n.loaded();t.list=i.data.data;t.count=i.data.count}).catch(function(t){n.loaded();n.alert(t)})}var f={listItemType:'<div class="list-type-item form-horizontal clearfix new" data-id="{id}">                <label class="pull-left control-label">                    <span>分类名称：<\/span>                <\/label>                <div class="pull-left width-35 margin-right-20 require relative">                    <input type="text" class="form-control" name="name" value="{name}" placeholder="请输入分类名称" />                <\/div>                <div class="pull-left width-20 margin-right-20 require relative">                    <input type="number" value="{sort}" name="sort" class="form-control" placeholder="排序码" />                <\/div>                <label class="pull-left control-label">                    <i class="fa pull-left opr-slide opr-icon absolute fa-remove type-remove" title="删除"><\/i>                <\/label>            <\/div>'},u,r,t;n("#btnType").click(function(){n.view({name:"type",title:"添加类别",url:"/product/addtype",footDisplay:"block"})});n(document).on("click","#btnAddType",function(){var u=n("#txtTypeName").val(),i=n(".list-type"),t=0,e=i.find(":not(div.remove) input[type='number']"),r;return e.each(function(){var i=n(this).val();i=i||0;i=parseInt(i);t<i&&(t=i)}),r=f.listItemType.format({id:0,name:u,sort:t+1}),i.append(r),n("#txtTypeName").val(""),!1}).on("click","#type .btn-save",function(){var i=n(".list-type"),u=i.find(".list-type-item.new"),f=i.find(".list-type-item.edit"),e=i.find(".list-type-item.remove"),t={add:[],edit:[],remove:[]};return u.each(function(){var i=n(this),r=i.find("input[name='name']").val(),u=i.find("input[name='sort']").val();t.add.push({name:r,sort:u,id:0})}),f.each(function(){var i=n(this),r=i.find("input[name='name']").val(),u=i.find("input[name='sort']").val(),f=i.data("id");t.edit.push({name:r,sort:u,id:f})}),e.each(function(){var i=n(this).data("id");t.remove.push(i)}),n.loading(),n.post("/product/updatetypes",t,function(t){var i,u;if(n.loaded(),!t.success){n.error(t.msg);return}i=t.data;n("#type").modal("hide");i.forEach(function(n){n.selected=!1});u=r.list.first(function(n){return n.selected});u&&(i.first(function(n){return n.id===u.id}).selected=!0);r.list=i}),!1}).on("change","#type input",function(){var i=n(this),t=i.closest(".list-type-item");t.length!==0&&(t.hasClass("new")||t.addClass("edit"))}).on("click","#type .fa-remove",function(){var t=n(this).closest(".list-type-item");if(t.hasClass("new")){t.remove();return}n.post("/product/existproduct/"+t.data("id"),null,function(i){if(i.data){n.danger("类别下存在商品，不允许删除");return}t.removeClass("edit").addClass("remove");t.hide()})});u={count:function(n){if(n.length===0)return 0;var t=0;return n.forEach(function(n){t+=n.count}),t}};r=new Vue({el:"#category",data:{list:pageData.types,productCount:u.count(pageData.types),allSelected:!0},methods:{typeClick:function(i){var r=this;t.pageIndex=1;n.loading();axios.get("Product/GetProducts?typeId="+i.id).then(function(u){n.loaded();r.list.forEach(function(n){n.selected=!1});i.selected=!0;r.allSelected=!1;t.list=u.data.data;t.count=u.data.count}).catch(function(t){n.loaded();n.alert(t)})},allClick:function(){var i=this;t.pageIndex=1;axios.get("Product/GetProducts").then(function(r){n.loaded();i.list.forEach(function(n){n.selected=!1});i.allSelected=!0;t.list=r.data.data;t.count=r.data.count}).catch(function(t){n.loaded();n.alert(t)})}}});Vue.filter("stock",function(n){return n<0?"无限":n});Vue.filter("attribute",function(n){if(!n||n.length===0)return"";var t="";return n.forEach(function(n){t+=n.name+"/"}),t.substr(0,t.length-1)});t=new Vue({el:"#productList",data:{list:[],allCheck:!1,pageIndex:1,count:0},computed:{pageCount:function(){return Math.ceil(this.count/20)}},methods:{getImage:function(n){return n.images.length===0?"":appConfig.apiUrl+"/File/Product/"+n.businessId+"/200x150/"+n.images[0].name+"."+n.images[0].extensionName},delProduct:function(t){var i=this;n.confirm("提示","确定删除商品【"+t.name+"】？",function(){return axios.post("/Product/DelProduct/"+t.id).then(function(r){if(!r.data.success){n.alert(r.data.msg);return}n.alert("删除成功","success");i.list.remove(t)}).catch(function(t){n.alert(t)}),!0})},toggleStatus:function(t){var i=t.status===1?"Down":"Up";axios.post("/Product/"+i+"/"+t.id).then(function(i){t.status=t.status===1?2:1;n.alert(i.data,"success")}).catch(function(t){n.alert(t)})},editProduct:function(n){window.location.href="/Product/AddProduct/"+n.id},toggleCheck:function(){var n=this;this.list.forEach(function(t){t.checked=!n.allCheck})},toggleProduct:function(){this.allCheck=!1},batchUp:function(){var t=this.list.filter(function(n){return n.checked&&n.status!==1}),i;if(t.length===0){n.alert("没有需要上架的商品","warning");return}i=t.select(n=>n.id);axios.put("/Product/BatchUp",i).then(function(i){if(!i.data.success){n.alert(i.data.msg);return}n.alert(i.data.msg,"success");t.forEach(function(n){n.status=1})}).catch(function(t){n.alert(t)})},batchDown:function(){var t=this.list.filter(function(n){return n.checked&&n.status===1}),i;if(t.length===0){n.alert("没有需要下架的商品","warning");return}i=t.select(n=>n.id);axios.put("/Product/BatchDown",i).then(function(i){if(!i.data.success){n.alert(i.data.msg);return}n.alert(i.data.msg,"success");t.forEach(function(n){n.status=2})}).catch(function(t){n.alert(t)})},batchRemove:function(){var r=this,i=this.list.filter(function(n){return n.checked}),t;if(i.length===0){n.alert("没有选择需要删除的商品","warning");return}t="";i.forEach(function(n){t+=n.name+"，"});t=t.substring(0,t.length-1);n.confirm("提示","确定删除商品【"+t+"】？",function(){n.loading();var t=i.select(n=>n.id);return axios.put("/Product/BatchRemove",t).then(function(t){if(n.loaded(),!t.data.success){n.alert(t.data.msg);return}n.alert(t.data.msg,"success");i.forEach(function(n){r.list.remove(n)})}).catch(function(t){n.loaded();n.alert(t)}),!0})},prev:function(){t.pageIndex!==1&&(t.pageIndex=t.pageIndex-1,i())},page:function(n){t.pageIndex=n;i()},next:function(){t.pageIndex!==t.pageCount&&(t.pageIndex=t.pageIndex+1,i())}}});i()})(jQuery);