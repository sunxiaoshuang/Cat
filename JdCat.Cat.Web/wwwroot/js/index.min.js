(function(n){"use strict";function h(){u=new WebSocket(pageData.orderUrl+"?id="+pageData.business.id);u.onmessage=function(n){var i=new Date,r=n.data.split("|"),u=r[0],t=r[1];t==4||t==8||t==16?e.play():t==32?o.play():f.play();s.list.push({code:u,time:i.getHours()+":"+i.getMinutes(),tip:t!==32})};u.onopen=function(n){console.log("服务已连接",n);r&&(r.modal("hide"),r=null)};u.onclose=function(t){if(t.reason){n.primary(t.reason);return}r||(r=n.primary("新订单提醒异常，请检查网络连接"));setTimeout(function(){h()},3e3)}}var t={initFunction:function(){t.$menu=n("#main-menu");t.$menu.metisMenu();t.$menu.on("click","a",function(){var i=n(this);i.siblings()[0]||(t.$menu.find("a.active-menu").removeClass("active-menu"),i.addClass("active-menu"))});n(window).bind("load resize",function(){n(this).width()<768?n("div.sidebar-collapse").addClass("collapse"):n("div.sidebar-collapse").removeClass("collapse")})},initialization:function(){t.initFunction()}},i,s;n(document).ready(function(){t.initFunction();n("#sideNav").click(function(){n(this).hasClass("closed")?(n(".navbar-side").animate({left:"0px"}),n(this).removeClass("closed"),n("#page-wrapper").animate({"margin-left":"260px"})):(n(this).addClass("closed"),n(".navbar-side").animate({left:"-260px"}),n("#page-wrapper").animate({"margin-left":"0px"}))})});i={$frame:n("#mainframe"),defaultUrl:"/Report",method:{hashchange:function(){var n=i.defaultUrl;window.location.href.indexOf("#")>-1&&(n=window.location.href.substring(window.location.href.indexOf("#")+1)||"/home/empty");i.$frame.attr("src",n)}}};window.onhashchange=function(){i.method.hashchange()};i.method.hashchange();n("#cbClose").bootstrapSwitch({onSwitchChange:function(t,i){(i=!i,pageData.business.isClose!==i)&&(pageData.business.isClose=i,n.loading(),axios.get(`/business/changeClose?isClose=${i}`).then(function(t){if(n.loaded(),!t.data.success){n.alert(t.data.msg);return}n.alert(i?"暂停营业":"营业中","success")}))}}).bootstrapSwitch("state",!pageData.business.isClose);var u,r,f=document.getElementById("newOrder"),e=document.getElementById("autoOrder"),o=document.getElementById("exceptionOrder");h();s=new Vue({el:"#msg",data:{list:[]},components:{"cat-order-msg":{data:function(){return{}},methods:{navigate:function(){s.list.remove(this.msg)}},props:["msg"],template:`
                        <li>
                            <a :href="'#/Order?code=' + msg.code" @click="navigate()">
                                <div :class="msg.tip ? '' : 'text-danger'">
                                    <i class="fa" :class="msg.tip ? 'fa-info-circle fa-fw text-primary' : 'fa-warning text-danger'"></i> {{msg.tip ? '您有一个新订单' : '异常订单'}}
                                    <span class="pull-right text-muted small">{{msg.time}}</span>
                                </div>
                            </a>
                        </li>`}}});n("body").one("click",function(){f.play();e.play();o.play();setTimeout(function(){f.pause();f.currentTime=0;e.pause();e.currentTime=0;o.pause();o.currentTime=0},20)})})(jQuery);