(function(){var r={"1":"未使用","2":"已使用","3":"已过期","4":"上架","5":"下架","6":"已领完","7":"未开始"},t,i=new Vue({el:"#app",data:{all:[],statusList:[{name:"--优惠券状态--",value:"0"},{name:"上架",value:"4"},{name:"未开始",value:"7"},{name:"已过期",value:"3"},{name:"已领完",value:"6"}],status:"0"},created:function(){var n=this;axios.get("/sale/getReturnList").then(function({data:t}){n.all=t})},methods:{validFilter:function(n){return n.validDay>0?"领取后"+n.validDay+"天":n.startDate.substring(0,10)+" 至 "+n.endDate.substring(0,10)},create:function(){if(!t){this.loadTemplate(this.create);return}var r;$.view({title:"创建优惠券",template:t,dialogWidth:700,footDisplay:"block",load:function(){r=new Vue({el:"#return",data:{entity:{costAmount:0,startDate:"",endDate:"",value:1,validDay:30,quantity:-1,minConsume:-1},timeType:0,isCreate:!0,quantityType:0,minConsumeType:0},watch:{quantityType:function(){if(this.quantityType==0){this.entity.quantity=-1;return}this.entity.quantity=1e3},minConsumeType:function(){if(this.minConsumeType==0){this.entity.minConsume=-1;return}this.entity.minConsume=1},timeType:function(){this.timeType==0?(this.entity.startDate=null,this.entity.endDate=null,this.entity.validDay=30):this.entity.validDay=-1}}});this.find("#txtStartDate").datetimepicker(n).on("changeDate",function(){r.entity.startDate=this.value});this.find("#txtEndDate").datetimepicker(n).on("changeDate",function(){r.entity.endDate=this.value});this.on("hidden.bs.modal",function(){r&&(r.$destroy(),r=null)})},submit:function(){var n=r.entity;if(r.timeType==0&&n.validDay<=0){$.alert("请正确输入有效天数");return}if(r.timeType==1){if(!n.startDate||!n.endDate){$.alert("请选择优惠券有效期时间");return}if(n.startDate>n.endDate){$.alert("请正确选择优惠券有效期时间");return}}if(n.value<=0){$.alert("券面金额必须大于零");return}if(r.quantityType==1&&n.quantity<=0){$.alert("发放数量必须大于零");return}if(r.minConsumeType==1&&n.minConsume<=0){$.alert("最低消费必须大于零");return}return $.loading(),axios.post("/sale/saveReturnCoupon",n).then(function({data:n}){$.alert("创建成功","success");i.all.push(n.data);$.loaded()}).catch(function(n){$.alert(n.message);$.loaded()}),!0}})},loadTemplate:function(n){var i=this;axios.get("/sale/returnCoupon").then(function({data:r}){t=r;n&&n.call(i)})},remove:function(n){var t=this;$.primary("确定删除吗？",function(){return axios.delete("/sale/deleteReturnCoupon/"+n.id).then(function(){$.alert("删除成功","success");t.all.remove(n)}).catch(function(n){$.alert(n)}),!0})},cat:function(n){console.log(n)},statusFilter:function(n){return r[n]}},computed:{list:function(){return this.status==0?this.all:this.all.filter(n=>n.status==this.status)}}}),n={format:"yyyy-mm-dd",autoclose:!0,maxView:1,minView:2,todayBtn:!0,todayHighlight:!0,language:"zh-CN"};$("#txtStartDate").datetimepicker(n).on("changeDate",function(){i.entity.startDate=this.value});$("#txtEndDate").datetimepicker(n).on("changeDate",function(){i.entity.endDate=this.value})})();