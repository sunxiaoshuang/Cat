(function(){var n=`
        <div class='row' id="selectProducts">
            <div class='col-xs-12'>
                <div class="input-group">
                    <input type="text" v-model="content" class="form-control" placeholder="输入内容...">
                    <span class="input-group-addon"><i class="fa fa-search"></i> 商品搜索</span>
                </div>
            </div>
            <div class='col-xs-12' style="height: 400px;">
                <ul class="list-group">
                    <li class="list-group-item" v-for="item in items">
                        <a @click="select(item)" class="text-primary">{{item.name + "[" + item.code + "]"}}</a>
                    </li>
                </ul>
            </div>
        </div>`,t=new Vue({el:"#app",data:{offset:0,limit:20,products:[],elemes:[],mappings:[],table:[]},methods:{merge:function(){var n=this,t=this.offset;this.table=this.elemes.map(function(i){var u=n.mappings.first(function(n){return n.thirdProductId==i.id}),r;return u?(r=n.products.first(function(n){return n.id===u.productId}),r||(r=n.products.first(function(n){return n.name===i.name}),u=!1)):r=n.products.first(function(n){return n.name===i.name}),{num:++t,name:i.name,localName:r?r.name:"",code:r?r.code:"",productId:r?r.id:0,pic:i.imageUrl,id:i.id,isSave:!!u}})},catImg:function(n){window.open(n.pic)},select:function(i){var r,u=$.view({title:"选择本地商品",template:n,dialogHeight:600,load:function(){r=new Vue({el:"#selectProducts",data:{content:"",items:[]},watch:{content:function(n){var i=t.products.filter(t=>t.name.indexOf(n)>-1||t.code.indexOf(n)>-1||t.pinyin.indexOf(n)>-1||t.firstLetter.indexOf(n)>-1);i.length>10&&(i.length=10);this.items=JSON.parse(JSON.stringify(i))}},methods:{select:function(n){i.localName=n.name;i.code=n.code;i.productId=n.id;i.isSave=!1;u.modal("hide")}}});this.on("hidden.bs.modal",function(){r&&(r.$destroy(),r=null)});setTimeout(()=>{u.find("input").focus()},500)}})},save:function(){var n,i;if(this.table.length===0){$.alert("没有需要保存的映射商品");return}let t=this;if(n=this.table.filter(function(n){return!!n.productId&&!n.isSave}),n.length===0&&this.table.length===0){$.alert("没有需要保存的映射商品");return}i=n.map(function(n){return{productId:n.productId,thirdProductName:n.name,thirdSource:1,thirdProductId:n.id}});axios.post(`/thirdOrder/saveMappings`,i).then(function(n){$.loaded();$.alert("保存成功","success");t.mappings=n.data;t.merge()}).catch(function(n){$.loaded();$.alert(n)})},next:function(){this.canNext&&(this.offset+=this.limit,this.loadData())},prev:function(){this.canPrev&&(this.offset-=this.limit,this.loadData())},loadData:function(){var n=this;axios.get(`/thirdOrder/eleme/getProducts?offset=${this.offset}&limit=${this.limit}`).then(function(t){n.elemes=t.data.result;n.merge()}).catch(function(n){$.alert(n)})},clear:function(){$.confirm("提示","确定清空已绑定的映射关系吗？",function(){axios.get(`/thirdOrder/clear?source=1`).then(function(){location.reload()})})}},computed:{canNext:function(){return this.table.length>=this.limit},canPrev:function(){return this.offset>0}},created:function(){var n=this;axios.all([axios.get(`/thirdOrder/eleme/getProducts?offset=${this.offset}&limit=${this.limit}`),axios.get("/thirdOrder/mappings?source=1"),axios.get("/thirdOrder/products")]).then(function(t){n.elemes=t[0].data.result;n.mappings=t[1].data;n.products=t[2].data;n.merge()}).catch(function(n){$.alert(n)})}})})();