(function(n){var t=new Vue({el:"#app",data:{entity:pageObj.business,cityList:pageObj.cityList,showError:!1,isChangeLogo:!1,startHour:pageObj.business.businessStartTime?pageObj.business.businessStartTime.split(":")[0]:"06",startMinus:pageObj.business.businessStartTime?pageObj.business.businessStartTime.split(":")[1]:"00",endHour:pageObj.business.businessEndTime?pageObj.business.businessEndTime.split(":")[0]:"21",endMinus:pageObj.business.businessEndTime?pageObj.business.businessEndTime.split(":")[1]:"00"},methods:{ret:function(){history.go(-1)},save:function(){var t=this.entity;if(!t.logoSrc){n.alert("请上传商户LOGO");return}if(!t.name||!t.address||!t.contact||!t.mobile||!t.freight||!t.businessLicense||!t.businessLicenseImage||!t.lng||!t.lat||!t.specialImage){n.alert("请将信息填写完整");this.showError=!0;return}t.businessStartTime=this.startHour+":"+this.startMinus;t.businessEndTime=this.endHour+":"+this.endMinus;this.showError=!1;n.loading();axios.post("/business/savebase?isChangeLogo="+(this.isChangeLogo?1:0),t).then(function(t){if(n.loaded(),!t.data.success){n.alert(t.data.msg);return}n.alert("保存成功","success")}).catch(function(t){n.loaded();n.alert(t)})},selectFile:function(){n("#file").click()},remove:function(){this.entity.logoSrc=null},uploadBusinessLicense:function(){n("#fileLicense").click()},uploadSpecialImage:function(){n("#fileSpecialImage").click()},changeBusinessLicense:function(n){var i=n.target.files[0],r=this,t;if(!i){this.entity.businessLicenseImage=null;return}t=new FileReader;t.onload=function(n){r.entity.businessLicenseImage=n.target.result};t.readAsDataURL(i)},changeSpecialImage:function(n){var i=n.target.files[0],r=this,t;if(!i){this.entity.specialImage=null;return}t=new FileReader;t.onload=function(n){r.entity.specialImage=n.target.result};t.readAsDataURL(i)}},computed:{logo:function(){var n=this.entity.logoSrc;return n?n.indexOf("data:image")>-1?n:`${appConfig.apiUrl}/File/Logo/${pageObj.business.id}/${n}`:n},license:function(){var n=this.entity.businessLicenseImage;return n?n.indexOf("data:image")>-1?n:`${appConfig.apiUrl}/File/License/${pageObj.business.id}/${n}`:n},specialImage:function(){var n=this.entity.specialImage;return n?n.indexOf("data:image")>-1?n:`${appConfig.apiUrl}/File/License/${pageObj.business.id}/${n}`:n}},filters:{}}),i;n("#switch").bootstrapSwitch({onSwitchChange:function(i,r){t.entity.isAutoReceipt!==r&&(t.entity.isAutoReceipt=r,n.loading(),axios.get(`/business/changeAutoReceipt?isAutoReceipt=${r}`).then(function(t){if(n.loaded(),!t.data.success){n.alert(t.data.msg);return}n.alert(r?"开启自动接单成功":"关闭自动接单成功","success")}))}}).bootstrapSwitch("state",t.entity.isAutoReceipt);n("#cbClose").bootstrapSwitch({onSwitchChange:function(i,r){t.entity.isClose!==r&&(t.entity.isClose=r,n.loading(),axios.get(`/business/changeClose?isClose=${r}`).then(function(t){if(n.loaded(),!t.data.success){n.alert(t.data.msg);return}n.alert(r?"开启营业模式成功":"店铺暂停营业","success")}))}}).bootstrapSwitch("state",t.entity.isClose);i=new bjj.PhotoClip("#clipArea",{size:[400,300],outputSize:[400,300],file:"#file",ok:"#clipBtn",loadStart:function(){n(".cover-wrap").fadeIn()},loadComplete:function(){},clipFinish:function(i){n(".cover-wrap").fadeOut();t.entity.logoSrc=i;t.isChangeLogo=!0}})})(jQuery);