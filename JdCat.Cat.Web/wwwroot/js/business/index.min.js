(function(n){var i,t=new Vue({el:"#app",data:{entity:pageObj.business,cityList:pageObj.cityList,timeList:[],province:[],city:null,area:null,showError:!1,isChangeLogo:!1},methods:{ret:function(){history.go(-1)},save:function(){var t=this.entity,i;if(!t.logoSrc){n.alert("请上传商户LOGO");return}if(!t.name||!t.address||!t.contact||!t.mobile||!t.businessLicense||!t.businessLicenseImage||!t.lng||!t.lat){n.alert("请将信息填写完整");this.showError=!0;return}if(!t.province||!t.city||!t.area){n.alert("请选择所在城市");return}if(i=this.timeHandler(),n.isArray(i))i[0]?(t.businessStartTime=i[0].start,t.businessEndTime=i[0].end):(t.businessStartTime=null,t.businessEndTime=null),i[1]?(t.businessStartTime2=i[1].start,t.businessEndTime2=i[1].end):(t.businessStartTime2=null,t.businessEndTime2=null),i[2]?(t.businessStartTime3=i[2].start,t.businessEndTime3=i[2].end):(t.businessStartTime3=null,t.businessEndTime3=null);else{n.alert(i);return}this.showError=!1;n.loading();axios.post("/business/savebase?isChangeLogo="+(this.isChangeLogo?1:0),t).then(function(t){if(n.loaded(),!t.data.success){n.alert(t.data.msg);return}n.alert("保存成功","success")}).catch(function(t){n.loaded();n.alert(t)})},selectFile:function(){n("#file").click()},remove:function(){this.entity.logoSrc=null},uploadBusinessLicense:function(){n("#fileLicense").click()},uploadSpecialImage:function(){n("#fileSpecialImage").click()},changeBusinessLicense:function(n){var i=n.target.files[0],r=this,t;if(!i){this.entity.businessLicenseImage=null;return}t=new FileReader;t.onload=function(n){r.entity.businessLicenseImage=n.target.result};t.readAsDataURL(i)},changeSpecialImage:function(n){var i=n.target.files[0],r=this,t;if(!i){this.entity.specialImage=null;return}t=new FileReader;t.onload=function(n){r.entity.specialImage=n.target.result};t.readAsDataURL(i)},addTime:function(){this.timeList.length>=3||this.timeList.push({startHour:"06",startMinus:"00",endHour:"20",endMinus:"00"})},removeTime:function(){this.timeList.length!==1&&this.timeList.pop()},timeHandler:function(){for(var t,u=[],n=0;n<this.timeList.length;){var i=this.timeList[n],r=i.startHour+":"+i.startMinus,f=i.endHour+":"+i.endMinus;if(f<=r)return"[营业时间"+n+"]结束时间必须大于开始时间";if(t&&t.end>=r)return"[营业时间"+(n+1)+"]必须大于[营业时间"+n+"]";t={start:r,end:f};u.push(t);n++}return u}},computed:{logo:function(){var n=this.entity.logoSrc;return n?n.indexOf("data:image")>-1?n:`${appConfig.apiUrl}/File/Logo/${pageObj.business.id}/${n}`:n},license:function(){var n=this.entity.businessLicenseImage;return n?n.indexOf("data:image")>-1?n:`${appConfig.apiUrl}/File/License/${pageObj.business.id}/${n}`:n},specialImage:function(){var n=this.entity.specialImage;return n?n.indexOf("data:image")>-1?n:`${appConfig.apiUrl}/File/License/${pageObj.business.id}/${n}`:n}},created:function(){var t=this.entity,r,u,f=this;!t.businessStartTime||!t.businessEndTime||(r=t.businessStartTime.split(":"),u=t.businessEndTime.split(":"),this.timeList.push({startHour:r[0],startMinus:r[1],endHour:u[0],endMinus:u[1]}));!t.businessStartTime2||!t.businessEndTime2||(r=t.businessStartTime2.split(":"),u=t.businessEndTime2.split(":"),this.timeList.push({startHour:r[0],startMinus:r[1],endHour:u[0],endMinus:u[1]}));!t.businessStartTime3||!t.businessEndTime3||(r=t.businessStartTime3.split(":"),u=t.businessEndTime3.split(":"),this.timeList.push({startHour:r[0],startMinus:r[1],endHour:u[0],endMinus:u[1]}));axios.get("/data/city.json").then(function(n){var r,t,u,e;i=n.data;for(r in i)f.province.push(r);if(f.entity.province){t=i[f.entity.province];f.city=[];for(u in t)f.city.push(u);f.entity.city&&(e=t[f.entity.city],f.area=JSON.parse(JSON.stringify(e)))}}).catch(function(t){n.alert(t)})},watch:{"entity.province":function(n){var r=i[n],t;this.city=[];for(t in r)this.city.push(t);this.area=[];this.entity.city=null;this.entity.area=null},"entity.city":function(n){if(n){var t=i[this.entity.province],r=t[n];this.area=JSON.parse(JSON.stringify(r));this.entity.area=null}}}}),r;n("#switch").bootstrapSwitch({onSwitchChange:function(i,r){t.entity.isAutoReceipt!==r&&(t.entity.isAutoReceipt=r,n.loading(),axios.get(`/business/changeAutoReceipt?isAutoReceipt=${r}`).then(function(t){if(n.loaded(),!t.data.success){n.alert(t.data.msg);return}n.alert(r?"开启自动接单成功":"关闭自动接单成功","success")}))}}).bootstrapSwitch("state",t.entity.isAutoReceipt);n("#cbClose").bootstrapSwitch({onSwitchChange:function(i,r){t.entity.isClose!==r&&(t.entity.isClose=r,n.loading(),axios.get(`/business/changeClose?isClose=${r}`).then(function(t){if(n.loaded(),!t.data.success){n.alert(t.data.msg);return}n.alert(r?"暂停营业中":"开启营业模式成功","success")}))}}).bootstrapSwitch("state",t.entity.isClose);r=new bjj.PhotoClip("#clipArea",{size:[400,400],outputSize:[400,400],file:"#file",ok:"#clipBtn",loadStart:function(){n(".cover-wrap").fadeIn()},loadComplete:function(){},clipFinish:function(i){n(".cover-wrap").fadeOut();t.entity.logoSrc=i;t.isChangeLogo=!0}});n("#btn-closeArea").click(function(){n(".cover-wrap").fadeOut()})})(jQuery);