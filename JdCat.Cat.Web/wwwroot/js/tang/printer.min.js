(function(){function t(n){var t=!n,e=t?{id:0,name:"",ip:"",port:9100,type:2,quantity:1,mode:0,format:80,scope:0,state:1}:JSON.parse(JSON.stringify(n)),o=[{name:"前台",value:1},{name:"后厨",value:2}],s=[{name:"一菜一打",value:0},{name:"一份一打",value:1},{name:"一单一打",value:2}],h=[{name:"58mm",value:58},{name:"80mm",value:80}],c=[{name:"正常",value:1},{name:"停用",value:2}],l=[{name:"外卖",value:1,checked:!1},{name:"堂食",value:2,checked:!1}],f;$.view({title:t?"新增打印机":"编辑打印机",footDisplay:"block",template:i,load:function(){f=new Vue({el:"#edit-printer",data:{entity:e,types:o,modes:s,formats:h,states:c,scopeList:l},created:function(){var n=this;this.scopeList.forEach(function(t){n.entity.scope&t.value&&(t.checked=!0)})}});u.call(this,f)},submit:function(){var i=f.entity,u,e;if(!i.name){$.alert("请输入打印机名称");return}if(!i.ip){$.alert("请输入IP地址");return}if(!jdCat.utilMethods.ipValid(i.ip)){$.alert("IP地址输入错误");return}if(!i.port){$.alert("请输入端口号");return}if(!i.quantity){$.alert("请输入打印数量");return}return u=0,f.scopeList.forEach(function(n){n.checked&&(u+=n.value)}),i.scope=u,e=t?"/tang/addPrinter":"/tang/updatePrinter",axios.post(e,i).then(function(u){if($.alert(t?"新增成功":"修改成功","success"),t){r.items.push(u.data);return}n.name=i.name;n.ip=i.ip;n.port=i.port;n.type=i.type;n.mode=i.mode;n.format=i.format;n.quantity=i.quantity;n.scope=i.scope;n.state=i.state;n.cashierName=i.cashierName}).catch(function(n){$.alert(n)}),!0}})}function u(n){this.on("hidden.bs.modal",function(){n&&(n.$destroy(),n=null)})}var i=`
        <div class="row form-horizontal" id="edit-printer">
            <div class="form-group">
                <label class="control-label col-xs-3">
                    打印机名称：
                </label>
                <div class="col-xs-8">
                    <input class="form-control" v-model.trim="entity.name" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    IP地址：
                </label>
                <div class="col-xs-8">
                    <input class="form-control" v-model.trim="entity.ip" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    端口号：
                </label>
                <div class="col-xs-8">
                    <input class="form-control" type="number" v-model.trim="entity.port" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    打印机类型：
                </label>
                <div class="col-xs-8">
                    <select class="form-control" v-model="entity.type">
                        <option v-for="item in types" :value="item.value">{{item.name}}</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    打印数量：
                </label>
                <div class="col-xs-8">
                    <input class="form-control" type="number" v-model.trim="entity.quantity" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    打印模式：
                </label>
                <div class="col-xs-8">
                    <select class="form-control" v-model="entity.mode">
                        <option v-for="item in modes" :value="item.value">{{item.name}}</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    打印机规格：
                </label>
                <div class="col-xs-8">
                    <select class="form-control" v-model="entity.format">
                        <option v-for="item in formats" :value="item.value">{{item.name}}</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    打印范围：
                </label>
                <div class="col-xs-8">
                    <div class="kui-checkbox checkbox pull-left m-left-md m-right-md margin-right-20" v-for="scope in scopeList">
                        <label class="label-checkbox">
                            <input type="checkbox" name="scope" v-model="scope.checked">
                            <span class="custom-checkbox"></span>
                            <span v-text="scope.name"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    相关收银台：
                </label>
                <div class="col-xs-8">
                    <input class="form-control" v-model.trim="entity.cashierName" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    状态：
                </label>
                <div class="col-xs-8">
                    <select class="form-control" v-model="entity.state">
                        <option v-for="item in states" :value="item.value">{{item.name}}</option>
                    </select>
                </div>
            </div>
        </div>
    `,r=new Vue({el:"#app",data:{items:null},methods:{add:function(){t()},modify:function(n){t(n)},remove:function(n){var t=this;$.primary(`确定删除打印机[${n.name}]吗？`,function(){return axios.delete(`/tang/deletePrinter/${n.id}`).then(function(i){if(!i.data.success){$.alert(i.data.msg);return}$.alert(i.data.msg,"success");t.items.remove(n)}).catch(function(n){$.alert(n)}),!0})},select:function(t){n(t)},modeFormat:function(n){return n===0?"一菜一打":n===1?"一份一打":n===2?"一单一打":void 0},scopeFormat:function(n){var t="";return n&1&&(t+="外卖;"),n&2&&(t+="堂食;"),t}},created:function(){var n=this;axios.get(`/tang/getPrinters`).then(function(t){n.items=t.data})}}),n=function(t){var i,r;$.loading();axios.all([axios.get(`/product/getProductTree`),axios.get(`/tang/selectProduct`)]).then(function(u){i=u[1].data;r=u[0].data.map(function(n){return n.checked=!1,n});$.loaded();n=function(n){var u,f=JSON.parse(JSON.stringify(r)),e=[],t=[];f.forEach(function(n){t=t.concat(n.list)});t.forEach(function(n){n.checked=!1});n.foodIds&&JSON.parse(n.foodIds).forEach(function(n){var i=t.first(function(t){return t.id===n});i&&(i.checked=!0,e.push(i))});$.view({title:`打印机[${n.name}]绑定菜单`,footDisplay:"block",template:i,dialogWidth:800,load:function(){u=new Vue({el:"#bindPrinter",data:{typeList:f,productList:e},methods:{open:function(n){n.checked=!n.checked},choice:function(n){n.checked||(n.checked=!0,this.productList.push(n))},remove:function(n){n.checked=!1;this.productList.remove(n)}}})},submit:function(){var t=JSON.stringify(u.productList.map(function(n){return n.id}));return axios.put(`/tang/updatePrinterProducts`,{id:n.id,foodIds:t}).then(function(i){$.alert(i.data.msg,"success");n.foodIds=t}).catch(function(n){$.alert(n)}),!0}})};n(t)}).catch(function(n){$.alert(n)})}})();