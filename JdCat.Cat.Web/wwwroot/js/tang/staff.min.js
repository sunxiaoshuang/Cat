(function(){function r(n){this.on("hidden.bs.modal",function(){n&&(n.$destroy(),n=null)})}var t=new Vue({el:"#app",data:{items:[]},methods:{add:function(){n()},modify:function(t){n(t)},remove:function(n){$.primary(`确定删除员工[${n.name}]吗？`,function(){return axios.delete(`/tang/deleteStaff/${n.id}`).then(function(i){if(!i.data.success){$.alert(i.data.msg);return}t.items.remove(n);$.alert(i.data.msg,"success")}).catch(function(n){$.alert(n)}),!0})},resetPwd:function(){var n,t=`
                    <div class="row form-horizontal" id="resetPwd">
                        <div class="form-group">
                            <label class="control-label col-xs-3">
                                <span class="require">新密码：</span>
                            </label>
                            <div class="col-xs-8">
                                <input class="form-control" type="password" v-model.trim="password" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-xs-3">
                                <span class="require">再次输入：</span>
                            </label>
                            <div class="col-xs-8">
                                <input class="form-control" type="password" v-model.trim="password1" />
                            </div>
                        </div>
                    </div>
                `;return function(i){$.view({title:"重置密码",footDisplay:"block",template:t,load:function(){n=new Vue({el:"#resetPwd",data:{password:"",password1:""}});r.call(this,n)},submit:function(){if(!n.password){$.alert("请输入新密码");return}if(n.password!==n.password1){$.alert("两次输入的密码不一致");return}return axios.put(`/tang/resetPassword/${i.id}?pwd=${n.password}`).then(function(n){if(!n.data.success){$.alert(n.data.msg);return}$.alert(n.data.msg,"success")}).catch(function(n){$.alert(n)}),!0}})}}(),bindProduct:function(n){(n.staffPost.authority&4)!=0&&i(n)},genderFormat:function(n){return n===1?"男":n===2?"女":"未知"},timeFormat:function(n){return n?n.substring(0,10):""}},created:function(){var n=this;axios.get("/tang/getStaffs").then(function(t){n.items=t.data.list})}}),n=function(i){var e,f,u;$.loading();axios.all([axios.get("/tang/editStaff"),axios.get("/tang/getStaffPosts")]).then(function(n){e=n[0].data;f=n[1].data.staffPosts||[];f=f.map(function(n){return{id:n.id,name:n.name}})}).then(function(){$.loaded();n=function(n){var o=!n,i=n||{};$.view({title:o?"新增员工":"编辑员工",footDisplay:"block",template:e,load:function(){var n=this;u=new Vue({el:"#edit-staff",data:{isAdd:o,name:i.name,alise:i.alise,password:"",password1:"",gender:i.gender||0,enterTime:i.enterTime?i.enterTime.substring(0,10):"",birthday:i.birthday?i.birthday.substring(0,10):"",cardId:i.cardId,staffPostId:i.staffPostId||0,posts:JSON.parse(JSON.stringify(f)),genderList:[{name:"男",value:1},{name:"女",value:2}]},created:function(){}});n.find(".birthday").datetimepicker($.dateOptions).on("changeDate",function(){u.birthday=this.value});n.find(".enterTime").datetimepicker($.dateOptions).on("changeDate",function(){u.enterTime=this.value});r.call(this,u)},submit:function(){if(!u.staffPostId){$.alert("请选择所属岗位");return}if(!u.name){$.alert("请输入员工姓名");return}if(!u.alise){$.alert("请输入登录帐号");return}if(o){if(!u.password){$.alert("请输入登录密码");return}if(u.password!==u.password1){$.alert("两次输入密码不一致");return}}if(!u.gender){$.alert("请选择员工性别");return}var r=o?"/tang/addStaff":"/tang/updateStaff",f={id:i.id||0,name:u.name,alise:u.alise,password:u.password,gender:u.gender,birthday:u.birthday,enterTime:u.enterTime,cardId:u.cardId,staffPostId:u.staffPostId};return axios.post(r,f).then(function(i){if(!i.data.success){$.alert(i.data.msg);return}$.alert(i.data.msg,"success");o?t.items.push(i.data.data):t.items.replace(n,i.data.data)}).catch(function(n){$.alert(n)}),!0}})};n(i)})},i=function(n){var t,r;$.loading();axios.all([axios.get(`/product/getProductTree?isSetMeal=1`),axios.get(`/tang/selectProductForCook`)]).then(function(u){t=u[1].data;r=u[0].data.map(function(n){return n.checked=!1,n});$.loaded();i=function(n){var u,f=JSON.parse(JSON.stringify(r)),e=[],i=[];f.forEach(function(n){i=i.concat(n.list)});i.forEach(function(n){n.checked=!1});axios.get(`/tang/getProductIdsByCook/${n.id}`).then(function(r){var o=r.data;o&&o.length>0&&o.forEach(function(n){var t=i.first(function(t){return t.id===n});t&&(t.checked=!0,e.push(t))});$.view({title:`厨师[${n.name}]绑定菜单`,footDisplay:"block",template:t,dialogWidth:800,load:function(){u=new Vue({el:"#bindCook",data:{typeList:f,productList:e},methods:{open:function(n){n.checked=!n.checked},choice:function(n){n.checked||(n.checked=!0,this.productList.push(n))},remove:function(n){n.checked=!1;this.productList.remove(n)}}})},submit:function(){var t=u.productList.map(function(t){return{staffId:n.id,productId:t.id}}),i=JSON.stringify(u.productList.map(function(n){return n.id}));return axios.post(`/tang/bindProductsForCook/${n.id}`,t).then(function(n){$.alert(n.data.msg,"success")}).catch(function(n){$.alert(n)}),!0}})}).catch(function(n){$.alert(n)})};i(n)}).catch(function(n){$.alert(n)})}})();