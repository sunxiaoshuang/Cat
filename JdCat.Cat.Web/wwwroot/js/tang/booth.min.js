(function(){function u(n){this.on("hidden.bs.modal",function(){n&&(n.$destroy(),n=null)})}var r=`
        <div class="row form-horizontal">
            <div class="form-group">
                <label class="control-label col-xs-3">
                    <span class="require">档口名称：</span>
                </label>
                <div class="col-xs-8">
                    <input class="form-control" autocomplete="off" id="name" />
                </div>
            </div>
        </div>
    `,t=new Vue({el:"#app",data:{items:[]},methods:{add:function(){i()},modify:function(n){i(n)},remove:function(n){$.primary(`确定删除档口[${n.name}]吗？`,function(){return axios.delete(`/tang/deleteBooth/${n.id}`).then(function(i){if(!i.data.success){$.alert("删除失败，请刷新后重试！");return}t.items.remove(n);$.alert("删除成功","success")}).catch(function(n){$.alert(n)}),!0})},bindProduct:function(t){n(t)}},created:function(){var n=this;axios.get("/tang/getBooths").then(function(t){n.items=t.data})}}),i=function(n){var i=!n,u=i?"":n.name;$.view({title:i?"新增档口":"修改档口",template:r,footDisplay:"block",load:function(){$("#name").val(u)},submit:function(){var r=$.trim($("#name").val()),u;if(!r){$.alert("请输入档口名称");return}return u=i?"/tang/addBooth":"/tang/updateBooth",axios.post(u,{id:i?0:n.id,name:r}).then(function(u){i?(t.items.push(u.data.data),$.alert("新增成功","success")):(n.name=r,$.alert("修改成功","success"))}).catch(function(n){$.alert(n)}),!0}})},n=function(t){var i,r;$.loading();axios.all([axios.get(`/product/getProductTree?isSetMeal=1`),axios.get(`/tang/checkProducts`)]).then(function(f){i=f[1].data;r=f[0].data.map(function(n){return n.checked=!1,n});$.loaded();var e=function(n){var e,o=JSON.parse(JSON.stringify(r)),s=[],t=[],f=this;o.forEach(function(n){t=t.concat(n.list)});t.forEach(function(n){n.checked=!1});n&&n.length>0&&n.forEach(function(n){var i=t.first(function(t){return t.id===n});i&&(i.checked=!0,s.push(i))});$.view({title:`档口[${f.name}]绑定菜单`,footDisplay:"block",template:i,dialogWidth:800,load:function(){e=new Vue({el:"#bindProduct",data:{typeList:o,productList:s},methods:{open:function(n){n.checked=!n.checked},choice:function(n){n.checked||(n.checked=!0,this.productList.push(n))},remove:function(n){n.checked=!1;this.productList.remove(n)}}});u.call(this,e)},submit:function(){var n=e.productList.map(function(n){return{staffId:f.id,productId:n.id}});return axios.post(`/tang/bindProductForBooth/${f.id}`,n).then(function(n){f.productIds=n.data.data.map(function(n){return n.productId});$.alert("绑定成功","success")}).catch(function(n){$.alert(n)}),!0}})};n=function(n){n.productIds?e.call(n,n.productIds):axios.get(`/tang/getProductIdsByBooth/${n.id}`).then(function(t){n.productIds=t.data;e.call(n,t.data)}).catch(function(n){$.alert(n)})};n(t)}).catch(function(n){$.alert(n)})}})();