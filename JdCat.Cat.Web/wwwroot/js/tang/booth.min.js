(function(){function u(n){this.on("hidden.bs.modal",function(){n&&(n.$destroy(),n=null)})}var r=`
        <div class="row form-horizontal">
            <div class="form-group">
                <label class="control-label col-xs-3">
                    <span class="require">档口名称：</span>
                </label>
                <div class="col-xs-8">
                    <input class="form-control" autocomplete="off" id="name" />
                </div>
            </div>
        </div>
    `,n=new Vue({el:"#app",data:{items:[]},methods:{add:function(){i()},modify:function(n){i(n)},remove:function(t){$.primary(`确定删除档口[${t.name}]吗？`,function(){return axios.delete(`/tang/deleteBooth/${t.id}`).then(function(i){if(!i.data.success){$.alert("删除失败，请刷新后重试！");return}n.items.remove(t);$.alert("删除成功","success")}).catch(function(n){$.alert(n)}),!0})},bindProduct:function(n){t(n)}},created:function(){var n=this;axios.get("/tang/getBooths").then(function(t){t.data.forEach(n=>n.productIds=null);n.items=t.data})}}),i=function(t){var i=!t,u=i?"":t.name;$.view({title:i?"新增档口":"修改档口",template:r,footDisplay:"block",load:function(){$("#name").val(u)},submit:function(){var r=$.trim($("#name").val()),u;if(!r){$.alert("请输入档口名称");return}return u=i?"/tang/addBooth":"/tang/updateBooth",axios.post(u,{id:i?0:t.id,name:r}).then(function(u){i?(u.data.data.productIds=[],n.items.push(u.data.data),$.alert("新增成功","success")):(t.name=r,$.alert("修改成功","success"))}).catch(function(n){$.alert(n)}),!0}})},t=function(i){var r,f;$.loading();axios.all([axios.get(`/product/getProductTree?isSetMeal=1`),axios.get(`/tang/checkProducts`)]).then(function(e){r=e[1].data;f=e[0].data.map(function(n){return n.checked=!1,n});$.loaded();var o=function(t){var o,s=JSON.parse(JSON.stringify(f)),h=[],i=[],e=this;s.forEach(function(n){i=i.concat(n.list)});i.forEach(function(t){(t.checked=!1,t.selected=!1,t.title="",n.items.forEach(n=>{n.productIds.indexOf(t.id)>-1&&(t.title+=n.name+",")}),t.title)&&(t.title=`已绑定${t.title.slice(0,t.title.length-1)}`)});t&&t.length>0&&t.forEach(function(n){var t=i.first(function(t){return t.id===n});t&&(t.checked=!0,h.push(t))});$.view({title:`档口[${e.name}]绑定菜单`,footDisplay:"block",template:r,dialogWidth:800,keyboard:!1,load:function(){o=new Vue({el:"#bindProduct",data:{typeList:s,products:i,productList:h,search:{key:"",result:[],boxHeight:0}},watch:{"search.key":function(n){this.seek(n)}},methods:{focus:function(){this.seek(this.search.key)},blur:function(){var n=this;setTimeout(function(){n.search.boxHeight=0},200)},seek:function(n){if(!n){this.search.result=[];this.search.boxHeight="0";return}this.search.boxHeight="120px";this.products.forEach(n=>n.selected=!1);this.search.result=this.products.filter(t=>t.name.indexOf(n)>-1||t.code.indexOf(n)>-1||t.pinyin.indexOf(n)>-1||t.firstLetter.indexOf(n)>-1).slice(0,8)},down:function(){var n=this;this.move(function(t){return t===n.search.result.length-1?t=0:t++,t})},up:function(){var n=this;this.move(function(t){return t===0?t=n.search.result.length-1:t===-1?t=0:t--,t})},enter:function(){var n=this.search.result.filter(n=>n.selected);n.length!==0&&this.clickItem(n[0])},clear:function(){this.search.key=""},move:function(n){if(this.search.result.length!==0){var r,t,i=this.search.result.filter(n=>n.selected);i.length>0&&(r=i[0]);t=this.search.result.indexOf(r);t=n(t);i.forEach(n=>n.selected=!1);this.search.result[t].selected=!0}},clickItem:function(n){n.checked||(n.checked=!0,this.productList.push(n))},open:function(n){n.checked=!n.checked},choice:function(n){n.checked||(n.checked=!0,this.productList.push(n))},remove:function(n){n.checked=!1;this.productList.remove(n)}}});u.call(this,o)},submit:function(){var n=o.productList.map(function(n){return{staffId:e.id,productId:n.id}});return axios.post(`/tang/bindProductForBooth/${e.id}`,n).then(function(n){e.productIds=n.data.data.map(function(n){return n.productId});$.alert("绑定成功","success")}).catch(function(n){$.alert(n)}),!0}})};t=function(t){t.productIds?o.call(t,t.productIds):axios.get(`/tang/getProductIdsWithBusinessBooth`).then(function(i){var r=i.data;n.items.forEach(n=>{var t=r.first(t=>t.id===n.id);t&&(n.productIds=t.ids)});o.call(t,t.productIds)}).catch(function(n){$.alert(n)})};t(i)}).catch(function(n){$.alert(n)})};$(document).on("mouseenter","a[title!=''], div[title!='']",function(){this.title&&$(this).tooltip()})})();