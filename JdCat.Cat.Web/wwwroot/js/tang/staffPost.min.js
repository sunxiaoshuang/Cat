(function(n){function u(n){this.on("hidden.bs.modal",function(){n&&(n.$destroy(),n=null)})}var i={1:"收银",2:"管理",4:"厨师",8:"服务员"},r=new Vue({el:"#app",data:{post:{items:[]},staff:{items:[]}},methods:{addPost:function(){t()},modifyPost:function(n){t(n)},removePost:function(t){n.primary(`确定删除岗位[${t.name}]吗？`,function(){return axios.delete(`/tang/deleteStaffPost/${t.id}`).then(function(i){if(!i.data.success){n.alert(i.data.msg);return}r.post.items.remove(t);n.alert(i.data.msg,"success")}).catch(function(t){n.alert(t)}),!0})},postAuthFormat:function(n){var t=[];for(var r in i)(r&n)!=0&&t.push(i[r]);return t.join("，")}},created:function(){var n=this;axios.get("/tang/getStaffPosts").then(function(t){n.post.items=t.data.staffPosts})}}),t=function(i){var s=null,o=null,f=null,e=!1,h=[{name:"收银",value:1,checked:!1},{name:"管理",value:2,checked:!1},{name:"厨师",value:4,checked:!1},{name:"服务员",value:8,checked:!1}];axios.get("/tang/editStaffPost").then(function(c){s=c.data;t=function(){f=arguments[0];e=!f;n.view({title:e?"新增岗位":"修改岗位",template:s,footDisplay:"block",load:function(){var n=JSON.parse(JSON.stringify(h));e||n.forEach(function(n){(f.authority&n.value)!=0&&(n.checked=!0)});o=new Vue({el:"#edit-post",data:{name:e?"":f.name,auths:n}});u.call(this,o)},submit:function(){var i=o.name,t=0,u,s;if(!i){n.alert("请输入岗位名称");return}if(o.auths.forEach(function(n){n.checked&&(t+=n.value)}),!t){n.alert("请选择岗位权限");return}return u=e?"/tang/addStaffPost":"/tang/updateStaffPost",s={id:e?0:f.id,name:i,authority:t},n.loading(),axios.post(u,s).then(function(u){if(n.loaded(),!u.data.success){n.alert(u.data.msg);return}e?r.post.items.push(u.data.data):(f.name=i,f.authority=t)}).catch(function(t){n.loaded();n.alert(t)}),!0}})};t(i)})}})(jQuery);