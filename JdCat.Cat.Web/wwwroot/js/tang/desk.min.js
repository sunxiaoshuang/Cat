(function(){function i(n){this.on("hidden.bs.modal",function(){n&&(n.$destroy(),n=null)})}var r=`
        <div class="row form-horizontal">
            <div class="form-group">
                <label class="control-label col-xs-3">
                    <span class="require">区域名称：</span>
                </label>
                <div class="col-xs-8">
                    <input class="form-control" id="typeName" />
                </div>
            </div>
        </div>
    `,u=`
        <div class="row form-horizontal" id="edit-type">
            <div class="form-group" v-for="item in items">
                <label class="control-label col-xs-3">
                    区域名称：
                </label>
                <div class="col-xs-4">
                    <input class="form-control" v-model.trim="item.name" />
                </div>
                <label class="control-label col-xs-2">
                    排序码：
                </label>
                <div class="col-xs-2">
                    <input class="form-control" type="number" v-model="item.sort" />
                </div>
            </div>
        </div>
    `,t=`
        <div class="row form-horizontal" id="edit-desk">
            <div class="form-group">
                <label class="control-label col-xs-3">
                    <span class="require">餐台名称：</span>
                </label>
                <div class="col-xs-8">
                    <input class="form-control" v-model.trim="entity.name" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    <span class="require">用餐人数：</span>
                </label>
                <div class="col-xs-8">
                    <input class="form-control" type="number" v-model.trim="entity.quantity" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-xs-3">
                    <span class="require">所属区域：</span>
                </label>
                <div class="col-xs-8">
                    <select class="form-control" v-model="entity.deskTypeId">
                        <option :value="option.id" v-for="option in options">{{option.name}}</option>
                    </select>
                </div>
            </div>
        </div>
    `,n=new Vue({el:"#app",data:{types:null,desks:null,count:0,allType:!0,selectedType:null},methods:{allClick:function(){this.allType||(this.allType=!0,this.allDesk(),this.selectedType=null)},typeClick:function(n){this.allType=!1;this.selectedType=n;this.types.forEach(function(n){n.selected=!1});n.selected=!0;this.desks=n.desks},addType:function(){var n=this;$.view({title:"新增类别",footDisplay:"block",template:r,load:function(){setTimeout(function(){$("#typeName").focus()},200)},submit:function(){var t=$.trim($("#typeName").val()),i;if(!t){$.alert("请输入类别名称");return}return i=n.types?n.types[n.types.length-1].sort+1:1,axios.post(`/tang/addDeskType`,{name:t,sort:i}).then(function(t){if(!t.data.success){$.alert(t.data.msg);return}$.alert(t.data.msg,"success");t.data.data.selected=!1;t.data.data.count=0;n.types.push(t.data.data)}).catch(function(n){$.alert(n)}),!0}})},removeType:function(){var t=this,n=this.types.first(function(n){return n.selected});if(!n){$.alert("请选择要删除的区域","warning");return}if(n.count>0){$.alert("区域下存在餐台，不允许删除");return}$.primary(`确定删除区域[${n.name}]吗？`,function(){return axios.delete(`/tang/deleteDeskType/${n.id}`).then(function(i){if(!i.data.success){$.alert(i.data.msg);return}$.alert(i.data.msg,"success");t.types.remove(n)}).catch(function(n){$.alert(n)}),!0})},modifyType:function(){if(!n.types||n.types.length===0){$.alert("不存在任何区域","warning");return}var t,r=n.types.map(function(n){return{id:n.id,name:n.name,sort:n.sort}});$.view({title:"修改区域",footDisplay:"block",template:u,load:function(){t=new Vue({el:"#edit-type",data:{items:r}});i.call(this,t)},submit:function(){var i=t.items.some(function(n){return!n.name});if(i){$.alert("区域名称不能为空");return}if(i=t.items.some(function(n){return!n.sort}),i){$.alert("排序码必须大于零");return}return axios.put("/tang/updateDeskTypes",t.items).then(function(i){if(!i.data.success){$.alert(i.data.msg);return}$.alert(i.data.msg,"success");t.items.forEach(function(t){var i=n.types.first(function(n){return n.id===t.id});i.name=t.name;i.sort=+t.sort});n.types.sort(function(n,t){return n.sort-t.sort})}).catch(function(n){$.alert(n)}),!0}})},addDesk:function(){if(!n.types||n.types.length===0){$.alert("请先创建餐台区域后新增餐台");return}var u=n.types.map(function(n){return{id:n.id,name:n.name}}),f={name:"",quantity:"",deskTypeId:n.selectedType?n.selectedType.id:0},r;$.view({title:"新增餐台",footDisplay:"block",template:t,load:function(){r=new Vue({el:"#edit-desk",data:{options:u,entity:f}});i.call(this,r)},submit:function(){if(!r.entity.name||r.entity.quantity<=0||!r.entity.deskTypeId){$.alert("请正确输入餐台信息");return}return axios.post("/tang/addDesk",r.entity).then(function(t){$.alert(t.data.msg,"success");var i=n.types.first(function(n){return n.id===t.data.data.deskTypeId});i.desks=i.desks||[];i.desks.push(t.data.data);i.count=i.desks.length;n.selectedType||n.allDesk()}).catch(function(n){$.alert(n)}),!0}})},editDesk:function(i){var f={name:i.name,id:i.id,deskTypeId:i.deskTypeId,quantity:i.quantity},r,e=n.types.map(function(n){return{id:n.id,name:n.name}}),u=n.types.first(function(n){return n.id===i.deskTypeId});$.view({title:"编辑餐台",footDisplay:"block",template:t,load:function(){r=new Vue({el:"#edit-desk",data:{entity:f,options:e}})},submit:function(){return axios.put(`/tang/updateDesk`,r.entity).then(function(t){if($.alert(t.data.msg,"success"),i.name=r.entity.name,i.quantity=r.entity.quantity,i.deskTypeId=r.entity.deskTypeId,i.deskTypeId!==u.id){var f=n.types.first(function(n){return n.id===i.deskTypeId});u.desks.remove(i);u.count--;f.desks.push(i);f.count++}}).catch(function(n){$.alert(n)}),!0}})},removeDesk:function(t){$.primary(`确定删除餐台[${t.name}]吗？`,function(){return axios.delete(`/tang/deleteDesk/${t.id}`).then(function(i){if(!i.data.success){$.alert(i.data.msg);return}$.alert(i.data.msg,"success");var r=n.types.first(function(n){return n.id===t.deskTypeId});r.desks.remove(t);r.count--;n.desks.remove(t);n.count--}).catch(function(n){$.alert(n)}),!0})},allDesk:function(){var n=[];this.types.forEach(function(t){(t.selected=!1,t.desks)&&(n=n.concat(t.desks))});this.desks=n;this.count=n.length}},created:function(){var n=this;axios.get("/tang/getDesks").then(function(t){t.data&&(t.data.forEach(function(n){n.count=n.desks?n.desks.length:0;n.selected=!1}),n.types=t.data,n.allDesk())})}})})();